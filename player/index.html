<style> body {background: black; color: white; font-family: monospace;} </style>
<div id="loading">LOADING...</div>
<video id="video0" style="display: none;" width="100%" height="100%" controls muted loop> <source src="video0" type="video/mp4"> </video>
<video id="video1" style="display: none;" width="100%" height="100%" controls muted loop> <source src="video1" type="video/mp4"> </video>

<script src='/socket.io/socket.io.js'></script>
<script>
	var savedTimecode = 0, firstLoad = false;

    var socket = io();

    socket.on('welcome', function(data) {
        // Respond with a message including this clients' id sent from the server
        socket.emit('i am client', {data: 'foo!', id: data.id});
    });
    socket.on('switch', function(data) {
		if (firstLoad) savedTimecode = video.currentTime;
        loadVideo(data);
    });
    socket.on('error', console.error.bind(console));
    socket.on('message', console.log.bind(console));


	function loadVideo(t) {
		video = document.getElementById('video'+t);
		// video.pause();
		video.load();

	    video.currentTime = savedTimecode;
		video.play();
		
		video.onloadeddata = (event) => {
			document.getElementById('loading').style.display = 'none';
			videos = document.getElementsByTagName('video');
			for (var i = 0; i < videos.length; i++) {
			    if (videos[i].id == 'video'+t) {
			        videos[i].style.display = "block";
			    } else {
			        videos[i].style.display = "none";
			    }
			}
		};

		firstLoad = true;
	}

</script>